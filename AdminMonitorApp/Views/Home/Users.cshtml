@{
    ViewBag.Title = "Users";
    Layout = "~/Views/Shared/_Layout.cshtml";

}


<div class="userContainer" style="z-index:99999999!important;background-color:white!important;color:black;">
    <table id="user" class="table table-bordered table-hover">
        <thead>
            <tr>
                <th>User Id</th>
                <th>User Name</th>
                <th>Spins</th>
                <th>Transactions</th>
                <th>Deactivate</th>

            </tr>
        </thead>
        <tbody></tbody>
    </table>
</div>

@section scripts {


    <script type="text/javascript">
        $(function () {

            var $table;

            $(document).ready(function () {
                $table = $("#user").DataTable
                (
                    {
                        ajax:
                        {
                            url: "http://localhost:63312/api/User/GetAll",
                            dataSrc: "",
                            contentType: "application/json; charset=utf-8",
                            dataType: "json"
                        },
                        columns:
                        [
                            {
                                data: "Id"
                            },
                            {
                                data: "UserName"
                            },
                            {
                                data: "Id",
                                render: function (data, type, user) {
                                    return "<button class='btn-link js-userspins' data-user-id=" +
                                        user.Id +
                                        ">User Spins</button>";

                                }
                            },
                            {
                                data: "Id",
                                render: function (data, type, user) {
                                    return "<button class='btn-link js-usertransactions' data-user-id=" +
                                        user.Id +
                                        ">User Transaction</button>";
                                }
                            },
                            {

                                data: "Id",
                                render: function (data, type, user) {
                                    return "<button class='btn-link js-deactivate' data-user-id=" +
                                        user.Id +
                                        ">Deactivate</button>";
                                }
                            }
                        ]

                    });
            });

            $("#user").on("click",
                ".js-userspins",
                function () {
                    var button = $(this);
                    var userId = button.attr("data-user-id");
                    alert(userId);
                    
                   
                    
                    bootbox.confirm("Are you sure you want to check this user's Spins?",
                        function (result) {
                            if (result) {
                                window.location.href = "/Home/GetSpins?userId="+userId;
                            }
                        });
                });

        });

            $("#user").on("click",
                ".js-usertransactions",
                function () {
                    var button = $(this);
                    var userId = button.attr("data-user-id");
                    bootbox.confirm("Are you sure you want to check this user's transactions?",
                        function (result) {
                            if (result) {
                              
                                        window.location.href = "/Home/GetTransactions?userId="+userId;                                 
                               
                            }
                        });
                });



            $("#user").on("click",
                ".js-deactivate",
                function() {
                    var button = $(this);



                    bootbox.confirm("Are you sure you want to deactivate this user?",
                        function(result) {
                            if (result) {
                                $.ajax({
                                    url: "http://localhost:63312/api/user/UpdateUserActiveStatus?status=false&userId=" + button.attr("data-user-id"),
                                    method: "GET",
                                    success: function(response) {
                                        $table.row(button.parents("tr").css("background-color", "grey")).draw();
                                        console.log(response);
                                    }
                                });
                            }
                        });
                });

      



    </script>
}


